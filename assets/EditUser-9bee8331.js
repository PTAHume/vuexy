import{D as F,C as E,w as e,b as se,B as S,ac as k,r as p,a3 as M,ad as G,E as ae,s as U}from"./index-88544c75.js";import{a as P,g as O,e as te,s as re,A as le}from"./App-1134afd0.js";import{u as T,C as v}from"./index.esm-49c96c79.js";import{C as $}from"./Card-ad598b24.js";import{C as H}from"./CardBody-4fc426c7.js";import{C as Y}from"./CardHeader-a10ca17e.js";import{C as J}from"./CardTitle-ac37ba94.js";import{F as _}from"./Form-3e20e82d.js";import{F as w}from"./FormFeedback-fb4a3029.js";import{I as N,L as b}from"./Label-aefd7ded.js";import{S as oe}from"./react-select.esm-7d6f9e8d.js";import"./pusher-ef6f9223.js";import"./index-b93cd64a.js";import{A as ne,w as ie,S as ce}from"./ext-component-sweet-alerts-bae240c2.js";import{C as me}from"./check-127ac529.js";import"./emotion-unitless.esm-7c38d562.js";const de=new F,ue=async s=>{try{const r=new FormData;return r.append("id",s.id),r.append("email",s.email),r.append("password",s.password),r.append("name",s.name),r.append("mobile",s.mobile),r.append("status",s.status),s.image&&s.image instanceof File&&r.append("image",s.image),await de.updateUser(r)}catch(r){throw r}},he={confirmCheckbox:!1},A=ie(ce),fe=({id:s})=>{const r=P(),i=E(),d=new F,{control:C,setError:j,handleSubmit:g,formState:{errors:c}}=T({defaultValues:he}),o=async()=>{const h=await A.fire({title:"Are you sure?",text:"Are you sure you would like to deactivate  account?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-danger ms-1"},buttonsStyling:!1});if(h.value)try{r(k(!0)),await d.deleteUser(s),r(k(!1)),A.fire({icon:"success",title:"Deleted!",text:"Account has been deactivated.",customClass:{confirmButton:"btn btn-success"}}),i(O())}catch(I){console.log(I)}else h.dismiss===A.DismissReason.cancel&&A.fire({title:"Cancelled",text:"Deactivation Cancelled!!",icon:"error",customClass:{confirmButton:"btn btn-success"}})},x=h=>{h.confirmCheckbox===!0?o():j("confirmCheckbox",{type:"manual"})};return e.jsxs($,{children:[e.jsx(Y,{className:"border-bottom",children:e.jsx(J,{tag:"h4",children:"Delete Account"})}),e.jsxs(H,{className:"py-2 my-25",children:[e.jsxs(ne,{color:"warning",children:[e.jsx("h4",{className:"alert-heading",children:"Are you sure you want to delete your account?"}),e.jsx("div",{className:"alert-body fw-normal",children:"Once you delete your account, there is no going back. Please be certain."})]}),e.jsxs(_,{onSubmit:g(x),children:[e.jsxs("div",{className:"form-check",children:[e.jsx(v,{control:C,name:"confirmCheckbox",render:({field:h})=>e.jsx(N,{...h,type:"checkbox",id:"confirmCheckbox",checked:h.value,invalid:c.confirmCheckbox&&!0})}),e.jsx(b,{for:"confirmCheckbox",className:se("form-check-label",{"text-danger":c&&c.confirmCheckbox}),children:"I confirm my account deactivation"}),c&&c.confirmCheckbox&&e.jsx(w,{children:"Please confirm that you want to delete account"})]}),e.jsx("div",{className:"mt-1",children:e.jsx(S,{color:"danger",children:"Deactivate Account"})})]})]})]})},pe=({redux:s})=>{var B,R,q,L,V;const[r,i]=p.useState(!1),d=[{value:1,label:"Active"},{value:0,label:"Inactive"}],[C,j]=p.useState(""),[g,c]=p.useState(null),[o,x]=p.useState("");E();const h=P(),I=new F,{id:m}=M(),K=a=>{const u=a.target.files;if(u.length>0){c(u[0]);const f=new FileReader;f.onload=function(){x(f.result)},f.readAsDataURL(u[0])}else c(null),x("")},Q=()=>{j("")};p.useEffect(()=>{var u,f;const a=o||((u=s.userData[m])!=null&&u.image?`${I.baseurl()}${(f=s.userData[m])==null?void 0:f.image}`:te);j(a)},[(B=s.userData[m])==null?void 0:B.image,o]);const W=async a=>{var f,z;if(i(!0),Object.values(a).every(t=>typeof t=="object"&&t!==null||t.length>0)){if(Object.values(a).every(t=>typeof t=="object"&&t!==null||t.length>0)&&(!n||Object.keys(n).length===0))try{const t={id:m,email:a.email,password:a.password,name:a.name,mobile:a.mobile,status:parseInt(a.status.value,10)};g?t.image=g:(f=s.userData[m])!=null&&f.image?t.image=(z=s.userData[m])==null?void 0:z.image:t.image="";const l=await ue(t);l.status===201&&(i(!1),localStorage.setItem("lastUpdated",Date.now()),h(G(l.data)),ae(e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"me-1",children:e.jsx(le,{size:"sm",color:"success",icon:e.jsx(me,{size:12})})}),e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("h6",{children:"Form Submitted!"}),e.jsx("div",{}),e.jsx("span",{children:"You have successfully updated the User details!"})]})]})))}catch(t){if(i(!1),t.response&&t.response.status===422){const l=t.response.data.errors;l.email?y("email",{type:"manual",message:l.email?l.email:"Incorrect  email"}):l.password?y("password",{type:"manual",message:l.password?l.password:"Incorrect  password"}):l.name?y("name",{type:"manual",message:l.name?l.name:"Incorrect  name"}):l.mobile?y("mobile",{type:"manual",message:l.mobile?l.mobile:"Incorrect  mobile"}):l.status&&y("status",{type:"manual",message:l.status?l.status:"Incorrect  status"})}else console.error("Unexpected error:",t)}}else{for(const t in a)(!a[t]||a[t].length===0)&&y(t,{type:"manual",message:`The ${t} field is required.`});i(!1)}},X=()=>{Z({email:"",mobile:"",password:"",name:""})},{reset:Z,control:D,setError:y,handleSubmit:ee,formState:{errors:n}}=T();return e.jsxs(p.Fragment,{children:[e.jsxs($,{children:[e.jsx(Y,{className:"border-bottom",children:e.jsx(J,{tag:"h4",children:"Edit User Details"})}),e.jsxs(H,{className:"py-2 my-25",children:[e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"me-25",children:e.jsx("img",{className:"rounded me-50",src:C,alt:"Generic placeholder image",height:"70",width:"100"})}),e.jsx("div",{className:"d-flex align-items-end mt-75 ms-1",children:e.jsxs("div",{children:[e.jsxs(S,{tag:b,className:"mb-75 me-75",size:"sm",color:"primary",children:["Upload",e.jsx(N,{type:"file",onChange:K,hidden:!0,accept:"image/*"})]}),e.jsx(S,{className:"mb-75",color:"secondary",size:"sm",outline:!0,onClick:Q,children:"Reset"}),e.jsx("p",{className:"mb-0",children:"Allowed JPG, GIF or PNG. Max size of 800kB"})]})})]}),e.jsxs(_,{className:"mt-2 pt-50",onSubmit:ee(W),children:[e.jsxs("div",{className:"mb-1",children:[e.jsx(b,{className:"form-label",for:"NameAsync",children:"Name"}),e.jsx(v,{defaultValue:((R=s.userData[m])==null?void 0:R.name)||"",control:D,rules:{required:"Name is required"},id:"NameAsync",name:"name",render:({field:a})=>e.jsx(N,{...a,placeholder:"Name",invalid:n.name&&!0})}),n.name&&e.jsx(w,{children:n.name.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(b,{className:"form-label",for:"mobileAsync",children:"Mobile Phone"}),e.jsx(v,{defaultValue:((q=s.userData[m])==null?void 0:q.mobile)||"",control:D,rules:{required:"Mobile is required"},id:"mobileAsync",name:"mobile",render:({field:a})=>e.jsx(N,{...a,placeholder:"Phone",type:"mobile",invalid:n.mobile&&!0})}),n.mobile&&e.jsx(w,{children:n.mobile.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(b,{className:"form-label",for:"emailAsync",children:"Email"}),e.jsx(v,{name:"email",id:"emailAsync",defaultValue:((L=s.userData[m])==null?void 0:L.email)||"",control:D,rules:{required:"Email is required"},render:({field:a})=>e.jsx(N,{...a,type:"email",placeholder:"example@email.com",invalid:n.email&&!0})}),n.email&&e.jsx(w,{children:n.email.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(b,{className:"form-label",for:"passwordAsync",children:"Password"}),e.jsx(v,{defaultValue:((V=s.userData[m])==null?void 0:V.password)||"",control:D,rules:{required:"Password is required"},id:"passwordAsync",name:"password",render:({field:a})=>e.jsx(N,{...a,type:"password",placeholder:"Password",invalid:n.password&&!0})}),n.password&&e.jsx(w,{children:n.password.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(b,{className:"form-label",for:"statusAsync",children:"Status"}),e.jsx(v,{id:"react-select",control:D,name:"status",defaultValue:d.find(a=>{var u;return a.value===(s.userData&&parseInt((u=s.userData[m])==null?void 0:u.status,10))}),render:({field:a})=>e.jsx(oe,{options:d,classNamePrefix:"select",theme:re,...a})}),n.status&&e.jsx(w,{children:n.status.message})]}),e.jsxs("div",{className:"d-flex",children:[e.jsx(S,{className:"me-1",color:"primary",disabled:r,type:"submit",children:"Submit"}),e.jsx(S,{outline:!0,color:"secondary",type:"reset",onClick:X,children:"Reset"})]}),e.jsx("div",{id:"loading-overlay",style:{display:r?"flex":"none"},children:e.jsx("div",{className:"loader"})})]})]})]}),e.jsx(fe,{id:m})]})},xe=({dataVersion:s})=>{const r=E(),{id:i}=M(),d=P(),C=new F,j=U(o=>o.userData.userData[i]),g=U(o=>o.userData.version),c=p.useCallback(async()=>{if(!(j&&g===s))try{d(k(!0));const x=(await C.getuserData(i)).data[0];d(G(x)),d(k(!1))}catch(o){console.log(o),o.response.status===404?r(O()):console.log("Error",o.message),d(k(!1))}},[i,d]);return p.useEffect(()=>{c()},[c]),p.useEffect(()=>{const o=x=>{x.key==="lastUpdated"&&c()};return window.addEventListener("storage",o),()=>{window.removeEventListener("storage",o)}},[c]),null},Pe=()=>{const s=U(i=>i.userData),r=s.loading;return e.jsxs("div",{children:[e.jsx(xe,{dataVersion:s.version,redux:s}),r?e.jsx("div",{id:"loading-overlay",style:{display:"flex"},children:e.jsx("div",{className:"loader"})}):e.jsx(pe,{dataVersion:s.version,redux:s})]})};export{Pe as default};
