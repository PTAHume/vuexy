import{D as F,C as P,w as e,b as ae,B as C,a2 as S,r as f,a3 as T,a4 as G,E as te,s as E}from"./index-edfb9ecc.js";import{a as B,g as O,f as re,s as ne,A as ie}from"./App-8a9c58a2.js";import{u as $,C as j}from"./index.esm-c136ca92.js";import{C as Y}from"./Card-f5f3dd14.js";import{C as H}from"./CardBody-3e0e306f.js";import{C as J}from"./CardHeader-aaebaceb.js";import{C as _}from"./CardTitle-40530812.js";import{F as K}from"./Form-7075ba97.js";import{F as b}from"./FormFeedback-adfdf615.js";import{I as v,L as g}from"./Label-b4125d8c.js";import{S as le}from"./react-select.esm-3295d704.js";import"./pusher-ef6f9223.js";import"./index-b93cd64a.js";import{A as oe,w as ce,S as me}from"./ext-component-sweet-alerts-dab43308.js";import{C as de}from"./check-7ed73700.js";const ue=new F,pe=async s=>{try{const n=new FormData;return n.append("id",s.id),n.append("email",s.email),n.append("password",s.password),n.append("type",s.type),n.append("name",s.name),n.append("mobile",s.mobile),n.append("status",s.status),s.image&&s.image instanceof File&&n.append("image",s.image),await ue.updateAdmin(n)}catch(n){throw n}},he={confirmCheckbox:!1},k=ce(me),fe=({id:s})=>{const n=B(),o=P(),d=new F,{control:A,setError:w,handleSubmit:N,formState:{errors:c}}=$({defaultValues:he}),l=async()=>{const p=await k.fire({title:"Are you sure?",text:"Are you sure you would like to deactivate your account?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-danger ms-1"},buttonsStyling:!1});if(p.value)try{n(S(!0)),await d.deleteAdmin(s),n(S(!1)),k.fire({icon:"success",title:"Deleted!",text:"Your account has been deactivated.",customClass:{confirmButton:"btn btn-success"}}),o(O())}catch(I){console.log(I)}else p.dismiss===k.DismissReason.cancel&&k.fire({title:"Cancelled",text:"Deactivation Cancelled!!",icon:"error",customClass:{confirmButton:"btn btn-success"}})},x=p=>{p.confirmCheckbox===!0?l():w("confirmCheckbox",{type:"manual"})};return e.jsxs(Y,{children:[e.jsx(J,{className:"border-bottom",children:e.jsx(_,{tag:"h4",children:"Delete Account"})}),e.jsxs(H,{className:"py-2 my-25",children:[e.jsxs(oe,{color:"warning",children:[e.jsx("h4",{className:"alert-heading",children:"Are you sure you want to delete your account?"}),e.jsx("div",{className:"alert-body fw-normal",children:"Once you delete your account, there is no going back. Please be certain."})]}),e.jsxs(K,{onSubmit:N(x),children:[e.jsxs("div",{className:"form-check",children:[e.jsx(j,{control:A,name:"confirmCheckbox",render:({field:p})=>e.jsx(v,{...p,type:"checkbox",id:"confirmCheckbox",checked:p.value,invalid:c.confirmCheckbox&&!0})}),e.jsx(g,{for:"confirmCheckbox",className:ae("form-check-label",{"text-danger":c&&c.confirmCheckbox}),children:"I confirm my account deactivation"}),c&&c.confirmCheckbox&&e.jsx(b,{children:"Please confirm that you want to delete account"})]}),e.jsx("div",{className:"mt-1",children:e.jsx(C,{color:"danger",children:"Deactivate Account"})})]})]})]})},xe=({redux:s})=>{var R,q,L,U,V,z;const[n,o]=f.useState(!1),d=[{value:1,label:"Active"},{value:0,label:"Inactive"}],[A,w]=f.useState(""),[N,c]=f.useState(null),[l,x]=f.useState("");P();const p=B(),I=new F,{id:m}=T(),Q=a=>{const u=a.target.files;if(u.length>0){c(u[0]);const h=new FileReader;h.onload=function(){x(h.result)},h.readAsDataURL(u[0])}else c(null),x("")},W=()=>{w("")};f.useEffect(()=>{var u,h;const a=l||((u=s.adminData[m])!=null&&u.image?`${I.baseurl()}${(h=s.adminData[m])==null?void 0:h.image}`:re);w(a)},[(R=s.adminData[m])==null?void 0:R.image,l]);const X=async a=>{var h,M;if(o(!0),Object.values(a).every(r=>typeof r=="object"&&r!==null||r.length>0)){if(Object.values(a).every(r=>typeof r=="object"&&r!==null||r.length>0)&&(!i||Object.keys(i).length===0))try{const r={id:m,email:a.email,password:a.password,type:a.type,name:a.name,mobile:a.mobile,status:parseInt(a.status.value,10)};N?r.image=N:(h=s.adminData[m])!=null&&h.image?r.image=(M=s.adminData[m])==null?void 0:M.image:r.image="";const t=await pe(r);t.status===201&&(o(!1),localStorage.setItem("lastUpdated",Date.now()),p(G(t.data)),te(e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"me-1",children:e.jsx(ie,{size:"sm",color:"success",icon:e.jsx(de,{size:12})})}),e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("h6",{children:"Form Submitted!"}),e.jsx("div",{}),e.jsx("span",{children:"You have successfully updated the Admin details!"})]})]})))}catch(r){if(o(!1),r.response&&r.response.status===422){const t=r.response.data.errors;t.email?y("email",{type:"manual",message:t.email?t.email:"Incorrect correct email"}):t.password?y("password",{type:"manual",message:t.password?t.password:"Incorrect correct password"}):t.name?y("name",{type:"manual",message:t.name?t.name:"Incorrect correct name"}):t.type?y("type",{type:"manual",message:t.type?t.type:"Incorrect correct type"}):t.mobile?y("mobile",{type:"manual",message:t.mobile?t.mobile:"Incorrect correct mobile"}):t.status?y("status",{type:"manual",message:t.status?t.status:"Incorrect correct status"}):t.image&&y("image",{type:"manual",message:t.image?t.image:"Incorrect image"})}else console.error("Unexpected error:",r)}}else{for(const r in a)(!a[r]||a[r].length===0)&&y(r,{type:"manual",message:`The ${r} field is required.`});o(!1)}},Z=()=>{ee({email:"",mobile:"",password:"",name:""})},{reset:ee,control:D,setError:y,handleSubmit:se,formState:{errors:i}}=$();return e.jsxs(f.Fragment,{children:[e.jsxs(Y,{children:[e.jsx(J,{className:"border-bottom",children:e.jsx(_,{tag:"h4",children:"Edit Admin Details"})}),e.jsxs(H,{className:"py-2 my-25",children:[e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"me-25",children:e.jsx("img",{className:"rounded me-50",src:A,alt:"Generic placeholder image",height:"70",width:"100"})}),e.jsx("div",{className:"d-flex align-items-end mt-75 ms-1",children:e.jsxs("div",{children:[e.jsxs(C,{tag:g,className:"mb-75 me-75",size:"sm",color:"primary",children:["Upload",e.jsx(v,{type:"file",onChange:Q,hidden:!0,accept:"image/*"})]}),e.jsx(C,{className:"mb-75",color:"secondary",size:"sm",outline:!0,onClick:W,children:"Reset"}),e.jsx("p",{className:"mb-0",children:"Allowed JPG, GIF or PNG. Max size of 800kB"}),i.image&&e.jsx("span",{className:"text-danger",children:i.image.message})]})})]}),e.jsxs(K,{className:"mt-2 pt-50",onSubmit:se(X),children:[e.jsxs("div",{className:"mb-1",children:[e.jsx(g,{className:"form-label",for:"NameAsync",children:"Name"}),e.jsx(j,{defaultValue:((q=s.adminData[m])==null?void 0:q.name)||"",control:D,rules:{required:"Name is required"},id:"NameAsync",name:"name",render:({field:a})=>e.jsx(v,{...a,placeholder:"Name",invalid:i.name&&!0})}),i.name&&e.jsx(b,{children:i.name.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(g,{className:"form-label",for:"mobileAsync",children:"Mobile Phone"}),e.jsx(j,{defaultValue:((L=s.adminData[m])==null?void 0:L.mobile)||"",control:D,rules:{required:"Mobile is required"},id:"mobileAsync",name:"mobile",render:({field:a})=>e.jsx(v,{...a,placeholder:"Phone",type:"mobile",invalid:i.mobile&&!0})}),i.mobile&&e.jsx(b,{children:i.mobile.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(g,{className:"form-label",for:"emailAsync",children:"Email"}),e.jsx(j,{name:"email",id:"emailAsync",defaultValue:((U=s.adminData[m])==null?void 0:U.email)||"",control:D,rules:{required:"Email is required"},render:({field:a})=>e.jsx(v,{...a,type:"email",placeholder:"example@email.com",invalid:i.email&&!0})}),i.email&&e.jsx(b,{children:i.email.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(g,{className:"form-label",for:"passwordAsync",children:"Password"}),e.jsx(j,{defaultValue:((V=s.adminData[m])==null?void 0:V.password)||"",control:D,rules:{required:"Password is required"},id:"passwordAsync",name:"password",render:({field:a})=>e.jsx(v,{...a,type:"password",placeholder:"Password",invalid:i.password&&!0})}),i.password&&e.jsx(b,{children:i.password.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(g,{className:"form-label",for:"typeAsync",children:"Admin Type"}),e.jsx(j,{defaultValue:((z=s.adminData[m])==null?void 0:z.type)||"",control:D,id:"typeAsync",name:"type",render:({field:a})=>e.jsx(v,{...a,type:"text",placeholder:"type",invalid:i.type&&!0})}),i.type&&e.jsx(b,{children:i.type.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(g,{className:"form-label",for:"statusAsync",children:"Status"}),e.jsx(j,{id:"react-select",control:D,name:"status",defaultValue:d.find(a=>{var u;return a.value===(s.adminData&&parseInt((u=s.adminData[m])==null?void 0:u.status,10))}),render:({field:a})=>e.jsx(le,{options:d,classNamePrefix:"select",theme:ne,...a})}),i.status&&e.jsx(b,{children:i.status.message})]}),e.jsxs("div",{className:"d-flex",children:[e.jsx(C,{className:"me-1",color:"primary",disabled:n,type:"submit",children:"Submit"}),e.jsx(C,{outline:!0,color:"secondary",type:"reset",onClick:Z,children:"Reset"})]}),e.jsx("div",{id:"loading-overlay",style:{display:n?"flex":"none"},children:e.jsx("div",{className:"loader"})})]})]})]}),e.jsx(fe,{id:m})]})},ye=({dataVersion:s})=>{const n=P(),{id:o}=T(),d=B(),A=new F,w=E(l=>l.adminData.adminData[o]),N=E(l=>l.adminData.version),c=f.useCallback(async()=>{if(!(w&&N===s))try{d(S(!0));const x=(await A.getAdminData(o)).data[0];d(G(x)),d(S(!1))}catch(l){console.log(l),l.response.status===404?n(O()):console.log("Error",l.message),d(S(!1))}},[o,d]);return f.useEffect(()=>{c()},[c]),f.useEffect(()=>{const l=x=>{x.key==="lastUpdated"&&c()};return window.addEventListener("storage",l),()=>{window.removeEventListener("storage",l)}},[c]),null},Be=()=>{const s=E(o=>o.adminData),n=s.loading;return e.jsxs("div",{children:[e.jsx(ye,{dataVersion:s.version,redux:s}),n?e.jsx("div",{id:"loading-overlay",style:{display:"flex"},children:e.jsx("div",{className:"loader"})}):e.jsx(xe,{dataVersion:s.version,redux:s})]})};export{Be as default};
