import{D as k,C as z,w as e,b as te,B as D,a2 as C,r as h,a3 as $,a4 as G,Q as re,s as F}from"./index-0fc361cd.js";import{a as E,g as T,f as ie,s as ne,A as le}from"./App-3bfa73bd.js";import{u as Y,C as x}from"./index.esm-71dc88ca.js";import{C as H}from"./Card-6627f822.js";import{C as J}from"./CardBody-40514bbc.js";import{C as O}from"./CardHeader-16c3b696.js";import{C as Q}from"./CardTitle-0013fb0c.js";import{F as K}from"./Form-7b9b553d.js";import{F as j}from"./FormFeedback-0c375e6a.js";import{I as y,L as f}from"./Label-5f0a973b.js";import{S as oe}from"./react-select.esm-d9654899.js";import{A as ce,w as me,S as de}from"./ext-component-sweet-alerts-20f3e105.js";import{c as M,a as A,o as ue}from"./customSelectValidation-b21f3e99.js";import{C as he}from"./check-5a810058.js";import"./Fade-7d5c8b17.js";const pe=new k,fe=async s=>{try{const t=new FormData;return t.append("id",s.id),t.append("email",s.email),t.append("password",s.password),t.append("type",s.type),t.append("name",s.name),t.append("mobile",s.mobile),t.append("status",s.status),s.image&&s.image instanceof File&&t.append("image",s.image),await pe.updateAdminDetails(t)}catch(t){throw t}},xe={confirmCheckbox:!1},S=me(de),je=({id:s})=>{const t=E(),c=z(),m=new k,{control:N,setError:b,handleSubmit:g,formState:{errors:l}}=Y({defaultValues:xe}),i=async()=>{const d=await S.fire({title:"Are you sure?",text:"Are you sure you would like to deactivate your account?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-danger ms-1"},buttonsStyling:!1});if(d.value)try{t(C(!0)),await m.deleteAdmin(s),t(C(!1)),S.fire({icon:"success",title:"Deleted!",text:"Your account has been deactivated.",customClass:{confirmButton:"btn btn-success"}}),c(T())}catch(q){console.log(q)}else d.dismiss===S.DismissReason.cancel&&S.fire({title:"Cancelled",text:"Deactivation Cancelled!!",icon:"error",customClass:{confirmButton:"btn btn-success"}})},p=d=>{d.confirmCheckbox===!0?i():b("confirmCheckbox",{type:"manual"})};return e.jsxs(H,{children:[e.jsx(O,{className:"border-bottom",children:e.jsx(Q,{tag:"h4",children:"Delete Account"})}),e.jsxs(J,{className:"py-2 my-25",children:[e.jsxs(ce,{color:"warning",children:[e.jsx("h4",{className:"alert-heading",children:"Are you sure you want to delete your account?"}),e.jsx("div",{className:"alert-body fw-normal",children:"Once you delete your account, there is no going back. Please be certain."})]}),e.jsxs(K,{onSubmit:g(p),children:[e.jsxs("div",{className:"form-check",children:[e.jsx(x,{control:N,name:"confirmCheckbox",render:({field:d})=>e.jsx(y,{...d,type:"checkbox",id:"confirmCheckbox",checked:d.value,invalid:l.confirmCheckbox&&!0})}),e.jsx(f,{for:"confirmCheckbox",className:te("form-check-label",{"text-danger":l&&l.confirmCheckbox}),children:"I confirm my account deactivation"}),l&&l.confirmCheckbox&&e.jsx(j,{children:"Please confirm that you want to delete account"})]}),e.jsx("div",{className:"mt-1",children:e.jsx(D,{color:"danger",children:"Deactivate Account"})})]})]})]})},ye=({redux:s})=>{var I,P,B,R,V,L;const[t,c]=h.useState(!1),m=[{value:1,label:"Active"},{value:0,label:"Inactive"}],[N,b]=h.useState(""),[g,l]=h.useState(null),[i,p]=h.useState(""),d=E(),q=new k,{id:o}=$(),W=a=>{const n=a.target.files;if(n.length>0){l(n[0]);const u=new FileReader;u.onload=function(){p(u.result)},u.readAsDataURL(n[0])}else l(null),p("")},X=M().shape({name:A().required("Name required"),email:A().required("Valid email required"),password:A().required("Password required"),mobile:A().required("Mobile required"),type:A().required("Admin type required"),status:M().transform((a,n)=>n??a).typeError("Status is required")}),{reset:Z,control:v,handleSubmit:_,formState:{errors:r}}=Y({resolver:ue(X)}),ee=()=>{b("")};h.useEffect(()=>{var n,u;const a=i||((n=s.adminData[o])!=null&&n.image?`${q.baseurl()}${(u=s.adminData[o])==null?void 0:u.image}`:ie);b(a)},[(I=s.adminData[o])==null?void 0:I.image,i]);const se=async a=>{var n,u;c(!0);try{const w={id:o,email:a.email,password:a.password,type:a.type,name:a.name,mobile:a.mobile,status:parseInt(a.status.value,10)};g?w.image=g:(n=s.adminData[o])!=null&&n.image?w.image=(u=s.adminData[o])==null?void 0:u.image:w.image="";const U=await fe(w);U.status===201&&(c(!1),localStorage.setItem("lastUpdated",Date.now()),d(G(U.data)),re(e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"me-1",children:e.jsx(le,{size:"sm",color:"success",icon:e.jsx(he,{size:12})})}),e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("h6",{children:"Form Submitted!"}),e.jsx("div",{}),e.jsx("span",{children:"You have successfully updated the Admin details!"})]})]})))}catch(w){console.error(w)}finally{c(!1)}},ae=()=>{Z({email:"",mobile:"",password:"",name:""})};return e.jsxs(h.Fragment,{children:[e.jsxs(H,{children:[e.jsx(O,{className:"border-bottom",children:e.jsx(Q,{tag:"h4",children:"Edit Admin Details"})}),e.jsxs(J,{className:"py-2 my-25",children:[e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"me-25",children:e.jsx("img",{className:"rounded me-50",src:N,alt:"Generic placeholder image",height:"70",width:"100"})}),e.jsx("div",{className:"d-flex align-items-end mt-75 ms-1",children:e.jsxs("div",{children:[e.jsxs(D,{tag:f,className:"mb-75 me-75",size:"sm",color:"primary",children:["Upload",e.jsx(y,{type:"file",onChange:W,hidden:!0,accept:"image/*"})]}),e.jsx(D,{className:"mb-75",color:"secondary",size:"sm",outline:!0,onClick:ee,children:"Reset"}),e.jsx("p",{className:"mb-0",children:"Allowed JPG, GIF or PNG. Max size of 800kB"}),r.image&&e.jsx("span",{className:"text-danger",children:r.image.message})]})})]}),e.jsxs(K,{className:"mt-2 pt-50",onSubmit:_(se),children:[e.jsxs("div",{className:"mb-1",children:[e.jsx(f,{className:"form-label",for:"NameAsync",children:"Name"}),e.jsx(x,{defaultValue:((P=s.adminData[o])==null?void 0:P.name)||"",control:v,rules:{required:"Name is required"},id:"NameAsync",name:"name",render:({field:a})=>e.jsx(y,{...a,placeholder:"Name",invalid:r.name&&!0})}),r.name&&e.jsx(j,{children:r.name.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(f,{className:"form-label",for:"mobileAsync",children:"Mobile Phone"}),e.jsx(x,{defaultValue:((B=s.adminData[o])==null?void 0:B.mobile)||"",control:v,rules:{required:"Mobile is required"},id:"mobileAsync",name:"mobile",render:({field:a})=>e.jsx(y,{...a,placeholder:"Phone",type:"mobile",invalid:r.mobile&&!0})}),r.mobile&&e.jsx(j,{children:r.mobile.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(f,{className:"form-label",for:"emailAsync",children:"Email"}),e.jsx(x,{name:"email",id:"emailAsync",defaultValue:((R=s.adminData[o])==null?void 0:R.email)||"",control:v,rules:{required:"Email is required"},render:({field:a})=>e.jsx(y,{...a,type:"email",placeholder:"example@email.com",invalid:r.email&&!0})}),r.email&&e.jsx(j,{children:r.email.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(f,{className:"form-label",for:"passwordAsync",children:"Password"}),e.jsx(x,{defaultValue:((V=s.adminData[o])==null?void 0:V.password)||"",control:v,rules:{required:"Password is required"},id:"passwordAsync",name:"password",render:({field:a})=>e.jsx(y,{...a,type:"password",placeholder:"Password",invalid:r.password&&!0})}),r.password&&e.jsx(j,{children:r.password.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(f,{className:"form-label",for:"typeAsync",children:"Admin Type"}),e.jsx(x,{defaultValue:((L=s.adminData[o])==null?void 0:L.type)||"",control:v,id:"typeAsync",name:"type",render:({field:a})=>e.jsx(y,{...a,type:"text",placeholder:"type",invalid:r.type&&!0})}),r.type&&e.jsx(j,{children:r.type.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(f,{className:"form-label",for:"statusAsync",children:"Status"}),e.jsx(x,{name:"status",id:"statusAsync",control:v,defaultValue:m.find(a=>{var n;return a.value===(s.adminData&&parseInt((n=s.adminData[o])==null?void 0:n.status,10))}),render:({field:a})=>e.jsx(oe,{options:m,classNamePrefix:"select",className:r.status?"isInvalid":"none",theme:ne,...a,value:a.value}),autocomplete:"off"}),r.status&&e.jsx(j,{style:{display:"flex"},children:r.status.message})]}),e.jsxs("div",{className:"d-flex",children:[e.jsx(D,{className:"me-1",color:"primary",disabled:t,type:"submit",children:"Submit"}),e.jsx(D,{outline:!0,color:"secondary",type:"reset",onClick:ae,children:"Reset"})]}),e.jsx("div",{id:"loading-overlay",style:{display:t?"flex":"none"},children:e.jsx("div",{className:"loader"})})]})]})]}),e.jsx(je,{id:o})]})},be=({dataVersion:s})=>{const t=z(),{id:c}=$(),m=E(),N=new k,b=F(i=>i.adminData.adminData[c]),g=F(i=>i.adminData.version),l=h.useCallback(async()=>{if(!(b&&g===s))try{m(C(!0));const p=(await N.getAdminData(c)).data[0];m(G(p)),m(C(!1))}catch(i){console.log(i),i.response.status===404?t(T()):console.log("Error",i.message),m(C(!1))}},[c,m]);return h.useEffect(()=>{l()},[l]),h.useEffect(()=>{const i=p=>{p.key==="lastUpdated"&&l()};return window.addEventListener("storage",i),()=>{window.removeEventListener("storage",i)}},[l]),null},Re=()=>{const s=F(c=>c.adminData),t=s.loading;return e.jsxs("div",{children:[e.jsx(be,{dataVersion:s.version,redux:s}),t?e.jsx("div",{id:"loading-overlay",style:{display:"flex"},children:e.jsx("div",{className:"loader"})}):e.jsx(ye,{dataVersion:s.version,redux:s})]})};export{Re as default};
