import{D as S,a0 as Z,a5 as ee,w as e,r as c,L as R,E as I,B as T}from"./index-0e942a82.js";import{A as se,E as ae,M as te,a as ne,b as re,B as le,D as ie,S as ce,P as oe,c as de,Q as me,C as pe,R as ue}from"./index.es-b66d1633.js";import{U as he,D as _,b as F,c as C,F as U,d as xe,M as ge,X as je,a as fe,P as ve,A as be}from"./App-0e4ef90f.js";import{I as j,L as v}from"./Label-14725e58.js";import{M as ye,T as Ne,E as Ce}from"./echo-1cca366a.js";import{F as De}from"./flatpickr-4d0139b3.js";import{I as y,a as N}from"./InputGroupText-ca26081d.js";import{C as Se,U as we}from"./calendar-e92560f2.js";import"./pusher-ef6f9223.js";import{R as ke,C as Pe}from"./Col-3ac23105.js";import{C as Te}from"./Card-14809446.js";import{C as Ee}from"./CardHeader-284ac7ca.js";import{C as Le}from"./CardTitle-2b08521e.js";import{C as ze}from"./check-d7f48b2c.js";const Ae=new S,Re=Z("admin/updateDealStatus",async({dealId:i,status:r},{dispatch:s})=>{try{return await Ae.updateDealStatus(i,r),s(ee.actions.updateDealStatus({dealId:i,status:r})),r}catch(o){throw console.log(o),new Error("Error updating status")}}),B=new S,We=(i,r)=>[{name:"ID",sortable:!0,maxWidth:"100px",selector:s=>s.id},{name:"User",sortable:!0,minWidth:"180px",cell:s=>e.jsx("div",{children:e.jsx("div",{style:{marginTop:"30px"},children:s.user_name})})},{name:"Departure",sortable:!0,minWidth:"200px",cell:s=>e.jsxs("div",{children:[e.jsx("div",{style:{marginTop:"5px"},children:s.departure_country}),e.jsx("div",{style:{marginTop:"5px"},children:s.departure_city}),e.jsx("div",{style:{marginTop:"5px"},children:s.departure_airport}),e.jsx("div",{style:{marginTop:"5px"},children:s.departure_date})]})},{name:"Arrival",sortable:!0,minWidth:"200px",cell:s=>e.jsxs("div",{children:[e.jsx("div",{style:{marginTop:"5px"},children:s.arrival_country}),e.jsx("div",{style:{marginTop:"5px"},children:s.arrival_city}),e.jsx("div",{style:{marginTop:"5px"},children:s.arrival_airport}),e.jsx("div",{style:{marginTop:"5px"},children:s.arrival_date})]})},{name:"Type",sortable:!0,minWidth:"80px",cell:s=>{switch(s.delivery_type){case"hand_luggage":return"Hand Luggage";case"baggage":return"Baggage";case"dcoument":return"Document";default:return""}}},{name:"Weight (Kg)",sortable:!0,minWidth:"140px",cell:s=>e.jsx("div",{children:e.jsx("div",{style:{marginTop:"15px"},children:s.weight})})},{name:"Flight",sortable:!0,minWidth:"100x",cell:s=>e.jsx("div",{children:e.jsxs("div",{children:["Flight : ",s.flight_number]})})},{name:"Price",sortable:!0,minWidth:"70px",selector:s=>s.price},{name:"Status",sortable:!0,minWidth:"153px",selector:s=>s.status,cell:s=>{const[o,n]=c.useState(s.status),[d,p]=c.useState(o==="approved"),h=async()=>{try{const u=d?"pending":"approved";I.promise(r(Re({dealId:s.id,status:u})),{position:"bottom-left",loading:"Updating the Status...",success:()=>(p(!d),n(u),"Saved successfully!"),error:g=>(console.log(g),"Error updating!")})}catch(u){return console.log(u),"Invalid Data!"}};return e.jsxs("div",{className:"form-switch form-check-primary",children:[e.jsx(j,{type:"switch",name:"icon-primary",id:"icon-primary",checked:d,onChange:()=>p(!d),onClick:h}),e.jsx("div",{style:{marginTop:"-1.4rem"},children:d?"Active":"InActive"})]})}},{name:"Actions",allowOverflow:!0,cell:s=>{const o=async()=>{try{await B.deleteDeal(s.id),console.log("Deal deleted successfully"),i()}catch(n){console.log(n)}};return e.jsxs("div",{className:"d-flex",children:[e.jsxs(he,{children:[e.jsx(_,{className:"pe-1",tag:"span",style:{cursor:"pointer"},children:e.jsx(ye,{size:15})}),e.jsxs(F,{end:!0,children:[e.jsxs(C,{tag:R,to:`${s.id}/edit`,className:"w-100",children:[e.jsx(U,{size:15}),e.jsx("span",{className:"align-middle ms-50",children:"Details"})]}),e.jsxs(C,{tag:"a",href:"/",className:"w-100",onClick:n=>n.preventDefault(),children:[e.jsx(se,{size:15}),e.jsx("span",{className:"align-middle ms-50",children:"Archive"})]}),e.jsxs(C,{tag:"a",href:"/",className:"w-100",onClick:n=>{n.preventDefault(),o(s.id)},children:[e.jsx(Ne,{size:15}),e.jsx("span",{className:"align-middle ms-50",children:"Delete"})]})]})]}),e.jsx(R,{to:`${s.id}/edit`,children:e.jsx(ae,{size:15})})]})}}],D=async(i=1,r=10,s="")=>{const o=i>0?i:0;try{const n=await B.getDealsData(o,r,s),d=n.data.slice(0,-1),p=n.data[n.data.length-1].pagination,h=p.total,u=p.perPage;return{deals:d,total:h,itemsPerPage:u}}catch(n){console.log(n)}},Ie=({open:i,handleModal:r})=>{const[s,o]=c.useState(new Date),n=e.jsx(je,{className:"cursor-pointer",size:15,onClick:r});return e.jsxs(te,{isOpen:i,toggle:r,className:"sidebar-sm",modalClassName:"modal-slide-in",contentClassName:"pt-0",children:[e.jsx(ne,{className:"mb-1",toggle:r,close:n,tag:"div",children:e.jsx("h5",{className:"modal-title",children:"New Record"})}),e.jsxs(re,{className:"flex-grow-1",children:[e.jsxs("div",{className:"mb-1",children:[e.jsx(v,{className:"form-label",for:"full-name",children:"Full Name"}),e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(xe,{size:15})}),e.jsx(j,{id:"full-name",placeholder:"Bruce Wayne"})]})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(v,{className:"form-label",for:"post",children:"Post"}),e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(le,{size:15})}),e.jsx(j,{id:"post",placeholder:"Web Developer"})]})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(v,{className:"form-label",for:"email",children:"Email"}),e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(ge,{size:15})}),e.jsx(j,{type:"email",id:"email",placeholder:"brucewayne@email.com"})]})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(v,{className:"form-label",for:"joining-date",children:"Joining Date"}),e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(Se,{size:15})}),e.jsx(De,{className:"form-control",id:"joining-date",value:s,onChange:d=>o(d)})]})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(v,{className:"form-label",for:"salary",children:"Salary"}),e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(ie,{size:15})}),e.jsx(j,{type:"number",id:"salary"})]})]}),e.jsx(T,{className:"me-1",color:"primary",onClick:r,children:"Submit"}),e.jsx(T,{color:"secondary",onClick:r,outline:!0,children:"Cancel"})]})]})},W=new S,_e=(i,r,s)=>{c.useEffect(()=>{let o;async function n(){const d=new Ce({broadcaster:"pusher",key:"alikoza",cluster:"mt1",encrypted:!1,wsHost:"api.dealmanager.co.uk",wsPort:6004,wssPort:6004,disableStats:!0,forceTLS:!1,authEndpoint:`${W.baseurl().replace(/\s/g,"")}/api/admin/subscribeToDealsList`,authorizer:h=>({authorize:async(u,g)=>{try{const x=await W.subscribeToDealsList(u,h.name);g(!1,x.data),r(x)}catch(x){g(!0,x),i(x)}}})}),p=d.private("deals");p.listen(".App\\Events\\Admin\\DealListUpdated",h=>{s(h)}),o=()=>{p.stopListening(".App\\Events\\Admin\\DealListUpdated"),d.disconnect()}}return n(),()=>{o&&o()}},[])},Fe=c.forwardRef((i,r)=>e.jsx("div",{className:"form-check",children:e.jsx(j,{type:"checkbox",ref:r,...i})})),as=()=>{const[i,r]=c.useState([]),[s,o]=c.useState(!1),[n,d]=c.useState(0),[p,h]=c.useState(""),[u,g]=c.useState([]),[x,w]=c.useState(0),[E,M]=c.useState(10),[L,k]=c.useState([]),[V,b]=c.useState(!0),$=new S,H=fe(),z=()=>o(!s);_e(t=>{t.response&&t.response.status===401&&$.refreshToken()},t=>{},t=>{b(!0);const a=t.deals;k(l=>{const m=l.findIndex(f=>f.id===a.id);return m!==-1?(a.status=a.status==="approved"?"approved":"pending",[...l.slice(0,m),a,...l.slice(m+1)]):l}),setTimeout(()=>{b(!1),I(e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"me-1",children:e.jsx(be,{size:"sm",color:"success",icon:e.jsx(ze,{size:12})})}),e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("h6",{children:"Form Updated!"}),e.jsx("div",{}),e.jsx("span",{children:"List refreshed!"})]})]}))},400)});const P=async(t=n)=>{try{b(!0);const{deals:a,total:l,itemsPerPage:m}=await D(t,E);k(a),w(l),M(m),b(!1)}catch(a){console.log(a),b(!1)}},O=We(P,H);c.useEffect(()=>{P()},[n]);const G=async t=>{const a=t.target.value;if(h(a),a.length){const{deals:l,total:m}=await D(1,10,a);g(l),w(m)}else{const{deals:l,total:m}=await D(1,10);g([]),k(l),w(m)}},Q=t=>{d(t.selected)},J=()=>e.jsx(ue,{previousLabel:"",nextLabel:"",forcePage:n,onPageChange:t=>Q(t),pageCount:x>0?Math.ceil(x/E):1,breakLabel:"...",pageRangeDisplayed:2,marginPagesDisplayed:2,activeClassName:"active",pageClassName:"page-item",breakClassName:"page-item",nextLinkClassName:"page-link",pageLinkClassName:"page-link",breakLinkClassName:"page-link",previousLinkClassName:"page-link",nextClassName:"page-item next-item",previousClassName:"page-item prev-item",containerClassName:"pagination react-paginate separated-pagination pagination-sm justify-content-end pe-1 mt-1"});function K(t){let a;const l=",",m=`
`,f=Object.keys(L[0]);return a="",a+=f.join(l),a+=m,t.forEach(q=>{let A=0;f.forEach(Y=>{A>0&&(a+=l),a+=q[Y],A++}),a+=m}),a}async function X(){let t;i.length>0?t=i:t=(await D(1,null,p)).deals;const a=document.createElement("a");let l=K(t);if(l===null)return;const m="export.csv";l.match(/^data:text\/csv/i)||(l=`data:text/csv;charset=utf-8,${l}`),a.setAttribute("href",encodeURI(l)),a.setAttribute("download",m),a.click()}return e.jsxs(c.Fragment,{children:[e.jsxs(Te,{children:[e.jsxs(Ee,{className:"flex-md-row flex-column align-md-items-center align-items-start border-bottom",children:[e.jsx(Le,{tag:"h4",children:"Admins List"}),e.jsxs("div",{className:"d-flex mt-md-0 mt-1",children:[e.jsxs(we,{children:[e.jsxs(_,{color:"secondary",caret:!0,outline:!0,children:[e.jsx(ce,{size:15}),e.jsx("span",{className:"align-middle ms-50",children:"Export"})]}),e.jsxs(F,{children:[e.jsxs(C,{className:"w-100",children:[e.jsx(oe,{size:15}),e.jsx("span",{className:"align-middle ms-50",children:"Print"})]}),e.jsxs(C,{className:"w-100",onClick:()=>X(),children:[e.jsx(U,{size:15}),e.jsx("span",{className:"align-middle ms-50",children:"CSV"})]})]})]}),e.jsxs(T,{className:"ms-2",color:"primary",onClick:z,children:[e.jsx(de,{size:15}),e.jsx("span",{className:"align-middle ms-50",children:"Add Record"})]})]})]}),e.jsx(ke,{className:"justify-content-end mx-0",children:e.jsxs(Pe,{className:"d-flex align-items-center justify-content-end mt-1",md:"6",sm:"12",children:[e.jsx(v,{className:"me-1",for:"search-input",children:"Search"}),e.jsx(j,{className:"dataTable-filter mb-50",type:"text",bsSize:"sm",id:"search-input",value:p,onChange:G})]})}),e.jsx("div",{className:"react-dataTable react-dataTable-selectable-rows",children:V?e.jsx("div",{className:"d-flex justify-content-center align-items-center py-5",children:e.jsx(ve,{color:"primary"})}):e.jsx(me,{noHeader:!0,pagination:!0,onPageChange:t=>P(t+1),selectableRows:!0,columns:O,paginationPerPage:10,className:"react-dataTable",sortIcon:e.jsx(pe,{size:10}),paginationComponent:J,paginationDefaultPage:n+1,selectableRowsComponent:Fe,data:p.length?u:L,onSelectedRowsChange:t=>r(t.selectedRows)})})]}),e.jsx(Ie,{open:s,handleModal:z})]})};export{as as default};
