import{D as F,C as M,w as e,b as ae,B as C,a2 as S,r as f,a3 as T,a4 as G,Q as te,s as E}from"./index-a9b8daf5.js";import{a as P,g as O,f as ne,s as re,A as ie}from"./App-d4f8e553.js";import{u as $,C as j}from"./index.esm-1d4b1d56.js";import{C as Y}from"./Card-a69e686c.js";import{C as H}from"./CardBody-f3d33399.js";import{C as J}from"./CardHeader-b593fd6d.js";import{C as Q}from"./CardTitle-235ffc14.js";import{F as K}from"./Form-34041cea.js";import{F as b}from"./FormFeedback-14ac7386.js";import{I as v,L as g}from"./Label-49e3a854.js";import{S as le}from"./react-select.esm-5a0b74be.js";import{A as oe,w as ce,S as me}from"./ext-component-sweet-alerts-d5fa1342.js";import{C as de}from"./check-04284558.js";import"./Fade-b7867c2b.js";const ue=new F,pe=async s=>{try{const r=new FormData;return r.append("id",s.id),r.append("email",s.email),r.append("password",s.password),r.append("type",s.type),r.append("name",s.name),r.append("mobile",s.mobile),r.append("status",s.status),s.image&&s.image instanceof File&&r.append("image",s.image),await ue.updateAdminDetails(r)}catch(r){throw r}},he={confirmCheckbox:!1},k=ce(me),fe=({id:s})=>{const r=P(),o=M(),d=new F,{control:A,setError:w,handleSubmit:N,formState:{errors:c}}=$({defaultValues:he}),l=async()=>{const p=await k.fire({title:"Are you sure?",text:"Are you sure you would like to deactivate your account?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-danger ms-1"},buttonsStyling:!1});if(p.value)try{r(S(!0)),await d.deleteAdmin(s),r(S(!1)),k.fire({icon:"success",title:"Deleted!",text:"Your account has been deactivated.",customClass:{confirmButton:"btn btn-success"}}),o(O())}catch(I){console.log(I)}else p.dismiss===k.DismissReason.cancel&&k.fire({title:"Cancelled",text:"Deactivation Cancelled!!",icon:"error",customClass:{confirmButton:"btn btn-success"}})},x=p=>{p.confirmCheckbox===!0?l():w("confirmCheckbox",{type:"manual"})};return e.jsxs(Y,{children:[e.jsx(J,{className:"border-bottom",children:e.jsx(Q,{tag:"h4",children:"Delete Account"})}),e.jsxs(H,{className:"py-2 my-25",children:[e.jsxs(oe,{color:"warning",children:[e.jsx("h4",{className:"alert-heading",children:"Are you sure you want to delete your account?"}),e.jsx("div",{className:"alert-body fw-normal",children:"Once you delete your account, there is no going back. Please be certain."})]}),e.jsxs(K,{onSubmit:N(x),children:[e.jsxs("div",{className:"form-check",children:[e.jsx(j,{control:A,name:"confirmCheckbox",render:({field:p})=>e.jsx(v,{...p,type:"checkbox",id:"confirmCheckbox",checked:p.value,invalid:c.confirmCheckbox&&!0})}),e.jsx(g,{for:"confirmCheckbox",className:ae("form-check-label",{"text-danger":c&&c.confirmCheckbox}),children:"I confirm my account deactivation"}),c&&c.confirmCheckbox&&e.jsx(b,{children:"Please confirm that you want to delete account"})]}),e.jsx("div",{className:"mt-1",children:e.jsx(C,{color:"danger",children:"Deactivate Account"})})]})]})]})},xe=({redux:s})=>{var B,R,q,L,U,V;const[r,o]=f.useState(!1),d=[{value:1,label:"Active"},{value:0,label:"Inactive"}],[A,w]=f.useState(""),[N,c]=f.useState(null),[l,x]=f.useState(""),p=P(),I=new F,{id:m}=T(),{reset:W,control:D,setError:y,handleSubmit:X,formState:{errors:i}}=$(),Z=a=>{const u=a.target.files;if(u.length>0){c(u[0]);const h=new FileReader;h.onload=function(){x(h.result)},h.readAsDataURL(u[0])}else c(null),x("")},_=()=>{w("")};f.useEffect(()=>{var u,h;const a=l||((u=s.adminData[m])!=null&&u.image?`${I.baseurl()}${(h=s.adminData[m])==null?void 0:h.image}`:ne);w(a)},[(B=s.adminData[m])==null?void 0:B.image,l]);const ee=async a=>{var h,z;if(o(!0),Object.values(a).every(n=>typeof n=="object"&&n!==null||n.length>0)){if(Object.values(a).every(n=>typeof n=="object"&&n!==null||n.length>0)&&(!i||Object.keys(i).length===0))try{const n={id:m,email:a.email,password:a.password,type:a.type,name:a.name,mobile:a.mobile,status:parseInt(a.status.value,10)};N?n.image=N:(h=s.adminData[m])!=null&&h.image?n.image=(z=s.adminData[m])==null?void 0:z.image:n.image="";const t=await pe(n);t.status===201&&(o(!1),localStorage.setItem("lastUpdated",Date.now()),p(G(t.data)),te(e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"me-1",children:e.jsx(ie,{size:"sm",color:"success",icon:e.jsx(de,{size:12})})}),e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("h6",{children:"Form Submitted!"}),e.jsx("div",{}),e.jsx("span",{children:"You have successfully updated the Admin details!"})]})]})))}catch(n){if(o(!1),n.response&&n.response.status===422){const t=n.response.data.errors;t.email?y("email",{type:"manual",message:t.email?t.email:"Incorrect correct email"}):t.password?y("password",{type:"manual",message:t.password?t.password:"Incorrect correct password"}):t.name?y("name",{type:"manual",message:t.name?t.name:"Incorrect correct name"}):t.type?y("type",{type:"manual",message:t.type?t.type:"Incorrect correct type"}):t.mobile?y("mobile",{type:"manual",message:t.mobile?t.mobile:"Incorrect correct mobile"}):t.status?y("status",{type:"manual",message:t.status?t.status:"Incorrect correct status"}):t.image&&y("image",{type:"manual",message:t.image?t.image:"Incorrect image"})}else console.error("Unexpected error:",n)}}else{for(const n in a)(!a[n]||a[n].length===0)&&y(n,{type:"manual",message:`The ${n} field is required.`});o(!1)}},se=()=>{W({email:"",mobile:"",password:"",name:""})};return e.jsxs(f.Fragment,{children:[e.jsxs(Y,{children:[e.jsx(J,{className:"border-bottom",children:e.jsx(Q,{tag:"h4",children:"Edit Admin Details"})}),e.jsxs(H,{className:"py-2 my-25",children:[e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"me-25",children:e.jsx("img",{className:"rounded me-50",src:A,alt:"Generic placeholder image",height:"70",width:"100"})}),e.jsx("div",{className:"d-flex align-items-end mt-75 ms-1",children:e.jsxs("div",{children:[e.jsxs(C,{tag:g,className:"mb-75 me-75",size:"sm",color:"primary",children:["Upload",e.jsx(v,{type:"file",onChange:Z,hidden:!0,accept:"image/*"})]}),e.jsx(C,{className:"mb-75",color:"secondary",size:"sm",outline:!0,onClick:_,children:"Reset"}),e.jsx("p",{className:"mb-0",children:"Allowed JPG, GIF or PNG. Max size of 800kB"}),i.image&&e.jsx("span",{className:"text-danger",children:i.image.message})]})})]}),e.jsxs(K,{className:"mt-2 pt-50",onSubmit:X(ee),children:[e.jsxs("div",{className:"mb-1",children:[e.jsx(g,{className:"form-label",for:"NameAsync",children:"Name"}),e.jsx(j,{defaultValue:((R=s.adminData[m])==null?void 0:R.name)||"",control:D,rules:{required:"Name is required"},id:"NameAsync",name:"name",render:({field:a})=>e.jsx(v,{...a,placeholder:"Name",invalid:i.name&&!0})}),i.name&&e.jsx(b,{children:i.name.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(g,{className:"form-label",for:"mobileAsync",children:"Mobile Phone"}),e.jsx(j,{defaultValue:((q=s.adminData[m])==null?void 0:q.mobile)||"",control:D,rules:{required:"Mobile is required"},id:"mobileAsync",name:"mobile",render:({field:a})=>e.jsx(v,{...a,placeholder:"Phone",type:"mobile",invalid:i.mobile&&!0})}),i.mobile&&e.jsx(b,{children:i.mobile.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(g,{className:"form-label",for:"emailAsync",children:"Email"}),e.jsx(j,{name:"email",id:"emailAsync",defaultValue:((L=s.adminData[m])==null?void 0:L.email)||"",control:D,rules:{required:"Email is required"},render:({field:a})=>e.jsx(v,{...a,type:"email",placeholder:"example@email.com",invalid:i.email&&!0})}),i.email&&e.jsx(b,{children:i.email.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(g,{className:"form-label",for:"passwordAsync",children:"Password"}),e.jsx(j,{defaultValue:((U=s.adminData[m])==null?void 0:U.password)||"",control:D,rules:{required:"Password is required"},id:"passwordAsync",name:"password",render:({field:a})=>e.jsx(v,{...a,type:"password",placeholder:"Password",invalid:i.password&&!0})}),i.password&&e.jsx(b,{children:i.password.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(g,{className:"form-label",for:"typeAsync",children:"Admin Type"}),e.jsx(j,{defaultValue:((V=s.adminData[m])==null?void 0:V.type)||"",control:D,id:"typeAsync",name:"type",render:({field:a})=>e.jsx(v,{...a,type:"text",placeholder:"type",invalid:i.type&&!0})}),i.type&&e.jsx(b,{children:i.type.message})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(g,{className:"form-label",for:"statusAsync",children:"Status"}),e.jsx(j,{id:"react-select",control:D,name:"status",defaultValue:d.find(a=>{var u;return a.value===(s.adminData&&parseInt((u=s.adminData[m])==null?void 0:u.status,10))}),render:({field:a})=>e.jsx(le,{options:d,classNamePrefix:"select",theme:re,...a})}),i.status&&e.jsx(b,{children:i.status.message})]}),e.jsxs("div",{className:"d-flex",children:[e.jsx(C,{className:"me-1",color:"primary",disabled:r,type:"submit",children:"Submit"}),e.jsx(C,{outline:!0,color:"secondary",type:"reset",onClick:se,children:"Reset"})]}),e.jsx("div",{id:"loading-overlay",style:{display:r?"flex":"none"},children:e.jsx("div",{className:"loader"})})]})]})]}),e.jsx(fe,{id:m})]})},ye=({dataVersion:s})=>{const r=M(),{id:o}=T(),d=P(),A=new F,w=E(l=>l.adminData.adminData[o]),N=E(l=>l.adminData.version),c=f.useCallback(async()=>{if(!(w&&N===s))try{d(S(!0));const x=(await A.getAdminData(o)).data[0];d(G(x)),d(S(!1))}catch(l){console.log(l),l.response.status===404?r(O()):console.log("Error",l.message),d(S(!1))}},[o,d]);return f.useEffect(()=>{c()},[c]),f.useEffect(()=>{const l=x=>{x.key==="lastUpdated"&&c()};return window.addEventListener("storage",l),()=>{window.removeEventListener("storage",l)}},[c]),null},Pe=()=>{const s=E(o=>o.adminData),r=s.loading;return e.jsxs("div",{children:[e.jsx(ye,{dataVersion:s.version,redux:s}),r?e.jsx("div",{id:"loading-overlay",style:{display:"flex"},children:e.jsx("div",{className:"loader"})}):e.jsx(xe,{dataVersion:s.version,redux:s})]})};export{Pe as default};
