import{M as P,aa as ee,af as ae,k as e,I as t,r as o,V as I,N as j,B as L}from"./index-4dd97072.js";import{A as te,E as se,M as ne,a as le,b as re,B as ie,D as ce,S as oe,P as de,c as me,Q as pe,C as ue,R as he}from"./index.es-72064fad.js";import{U as ge,D as B,b as F,c as k,F as U,d as fe,M as ve,X as be,a as ye,P as Ne,A as Ce}from"./App-f3de4e19.js";import{I as v,L as N}from"./Label-7ab053fe.js";import{M as De,T as xe,E as Se}from"./echo-d69d6e7c.js";import{F as ke}from"./flatpickr-279b113d.js";import{I as x,a as S}from"./InputGroupText-a76620f7.js";import{C as we,U as Pe}from"./calendar-e0a70df6.js";import"./pusher-ef6f9223.js";import{R as Te,C as ze}from"./Col-797d78e8.js";import{C as Le}from"./Card-9829a921.js";import{C as Ae}from"./CardHeader-179663a4.js";import{C as Ee}from"./CardTitle-d48e30d6.js";import{C as Re}from"./check-31ee2ba1.js";import"./emotion-memoize.esm-f5713a00.js";const We=new P,Ie=ee("admin/updateDealStatus",async({dealId:c,status:r},{dispatch:a})=>{try{return await We.updateDealStatus(c,r),a(ae.actions.updateDealStatus({dealId:c,status:r})),r}catch(d){throw console.log(d),new Error("Error updating status")}}),M=new P,_e=(c,r)=>[{name:"ID",sortable:!0,maxWidth:"100px",selector:a=>a.id},{name:"User",sortable:!0,minWidth:"180px",cell:a=>e("div",{children:e("div",{style:{marginTop:"30px"},children:a.user_name})})},{name:"Departure",sortable:!0,minWidth:"200px",cell:a=>t("div",{children:[e("div",{style:{marginTop:"5px"},children:a.departure_country}),e("div",{style:{marginTop:"5px"},children:a.departure_city}),e("div",{style:{marginTop:"5px"},children:a.departure_airport}),e("div",{style:{marginTop:"5px"},children:a.departure_date})]})},{name:"Arrival",sortable:!0,minWidth:"200px",cell:a=>t("div",{children:[e("div",{style:{marginTop:"5px"},children:a.arrival_country}),e("div",{style:{marginTop:"5px"},children:a.arrival_city}),e("div",{style:{marginTop:"5px"},children:a.arrival_airport}),e("div",{style:{marginTop:"5px"},children:a.arrival_date})]})},{name:"Type",sortable:!0,minWidth:"80px",cell:a=>{switch(a.delivery_type){case"hand_luggage":return"Hand Luggage";case"baggage":return"Baggage";case"dcoument":return"Document";default:return""}}},{name:"Weight (Kg)",sortable:!0,minWidth:"140px",cell:a=>e("div",{children:e("div",{style:{marginTop:"15px"},children:a.weight})})},{name:"Flight",sortable:!0,minWidth:"100x",cell:a=>e("div",{children:t("div",{children:["Flight : ",a.flight_number]})})},{name:"Price",sortable:!0,minWidth:"70px",selector:a=>a.price},{name:"Status",sortable:!0,minWidth:"153px",selector:a=>a.status,cell:a=>{const[d,l]=o.useState(a.status),[m,u]=o.useState(d==="approved");return t("div",{className:"form-switch form-check-primary",children:[e(v,{type:"switch",name:"icon-primary",id:"icon-primary",checked:m,onChange:()=>u(!m),onClick:async()=>{try{const h=m?"pending":"approved";j.promise(r(Ie({dealId:a.id,status:h})),{position:"bottom-left",loading:"Updating the Status...",success:()=>(u(!m),l(h),"Saved successfully!"),error:b=>(console.log(b),"Error updating!")})}catch(h){return console.log(h),"Invalid Data!"}}}),e("div",{style:{marginTop:"-1.4rem"},children:m?"Active":"InActive"})]})}},{name:"Actions",allowOverflow:!0,cell:a=>{const d=async()=>{try{await M.deleteDeal(a.id),console.log("Deal deleted successfully"),c()}catch(l){console.log(l)}};return t("div",{className:"d-flex",children:[t(ge,{children:[e(B,{className:"pe-1",tag:"span",style:{cursor:"pointer"},children:e(De,{size:15})}),t(F,{end:!0,children:[t(k,{tag:I,to:`${a.id}/edit`,className:"w-100",children:[e(U,{size:15}),e("span",{className:"align-middle ms-50",children:"Details"})]}),t(k,{tag:"a",href:"/",className:"w-100",onClick:l=>l.preventDefault(),children:[e(te,{size:15}),e("span",{className:"align-middle ms-50",children:"Archive"})]}),t(k,{tag:"a",href:"/",className:"w-100",onClick:l=>{l.preventDefault(),d(a.id)},children:[e(xe,{size:15}),e("span",{className:"align-middle ms-50",children:"Delete"})]})]})]}),e(I,{to:`${a.id}/edit`,children:e(se,{size:15})})]})}}],w=async(c=1,r=10,a="")=>{const d=c>0?c:0;try{const l=await M.getDealsData(d,r,a),m=l.data.slice(0,-1),u=l.data[l.data.length-1].pagination,f=u.total,h=u.perPage;return{deals:m,total:f,itemsPerPage:h}}catch(l){console.log(l)}},je=({open:c,handleModal:r})=>{const[a,d]=o.useState(new Date);return t(ne,{isOpen:c,toggle:r,className:"sidebar-sm",modalClassName:"modal-slide-in",contentClassName:"pt-0",children:[e(le,{className:"mb-1",toggle:r,close:e(be,{className:"cursor-pointer",size:15,onClick:r}),tag:"div",children:e("h5",{className:"modal-title",children:"New Record"})}),t(re,{className:"flex-grow-1",children:[t("div",{className:"mb-1",children:[e(N,{className:"form-label",for:"full-name",children:"Full Name"}),t(x,{children:[e(S,{children:e(fe,{size:15})}),e(v,{id:"full-name",placeholder:"Bruce Wayne"})]})]}),t("div",{className:"mb-1",children:[e(N,{className:"form-label",for:"post",children:"Post"}),t(x,{children:[e(S,{children:e(ie,{size:15})}),e(v,{id:"post",placeholder:"Web Developer"})]})]}),t("div",{className:"mb-1",children:[e(N,{className:"form-label",for:"email",children:"Email"}),t(x,{children:[e(S,{children:e(ve,{size:15})}),e(v,{type:"email",id:"email",placeholder:"brucewayne@email.com"})]})]}),t("div",{className:"mb-1",children:[e(N,{className:"form-label",for:"joining-date",children:"Joining Date"}),t(x,{children:[e(S,{children:e(we,{size:15})}),e(ke,{className:"form-control",id:"joining-date",value:a,onChange:m=>d(m)})]})]}),t("div",{className:"mb-1",children:[e(N,{className:"form-label",for:"salary",children:"Salary"}),t(x,{children:[e(S,{children:e(ce,{size:15})}),e(v,{type:"number",id:"salary"})]})]}),e(L,{className:"me-1",color:"primary",onClick:r,children:"Submit"}),e(L,{color:"secondary",onClick:r,outline:!0,children:"Cancel"})]})]})},_=new P,Be=(c,r,a)=>{o.useEffect(()=>{let d;async function l(){const m=new Se({broadcaster:"pusher",key:"alikoza",cluster:"mt1",encrypted:!1,wsHost:"https://api.dealmanager.co.uk",wsPort:6001,wssPort:6001,disableStats:!0,forceTLS:!1,authEndpoint:`${_.baseurl().replace(/\s/g,"")}/api/admin/subscribeToDealsList`,authorizer:(f,h)=>({authorize:async(b,C)=>{try{const g=await _.subscribeToDealsList(b,f.name);C(!1,g.data),r(g)}catch(g){C(!0,g),c(g)}}})}),u=m.private("deals");u.listen(".App\\Events\\Admin\\DealListUpdated",f=>{a(f)}),d=()=>{u.stopListening(".App\\Events\\Admin\\DealListUpdated"),m.disconnect()}}return l(),()=>{d&&d()}},[])},Fe=o.forwardRef((c,r)=>e("div",{className:"form-check",children:e(v,{type:"checkbox",ref:r,...c})})),na=()=>{const[c,r]=o.useState([]),[a,d]=o.useState(!1),[l,m]=o.useState(0),[u,f]=o.useState(""),[h,b]=o.useState([]),[C,g]=o.useState(0),[A,V]=o.useState(10),[E,T]=o.useState([]),[$,D]=o.useState(!0),H=new P,O=ye(),R=()=>d(!a);Be(n=>{n.response&&n.response.status===401&&H.refreshToken()},n=>{},n=>{D(!0);const s=n.deals;T(i=>{const p=i.findIndex(y=>y.id===s.id);return p!==-1?(s.status=s.status==="approved"?"approved":"pending",[...i.slice(0,p),s,...i.slice(p+1)]):i}),setTimeout(()=>{D(!1),j(t("div",{className:"d-flex",children:[e("div",{className:"me-1",children:e(Ce,{size:"sm",color:"success",icon:e(Re,{size:12})})}),t("div",{className:"d-flex flex-column",children:[e("h6",{children:"Form Updated!"}),e("div",{}),e("span",{children:"List refreshed!"})]})]}))},400)});const z=async(n=l)=>{try{D(!0);const{deals:s,total:i,itemsPerPage:p}=await w(n,A);T(s),g(i),V(p),D(!1)}catch(s){console.log(s),D(!1)}},G=_e(z,O);o.useEffect(()=>{z()},[l]);const Q=async n=>{const s=n.target.value;if(f(s),s.length){const{deals:i,total:p}=await w(1,10,s);b(i),g(p)}else{const{deals:i,total:p}=await w(1,10);b([]),T(i),g(p)}},J=n=>{m(n.selected)},K=()=>e(he,{previousLabel:"",nextLabel:"",forcePage:l,onPageChange:n=>J(n),pageCount:C>0?Math.ceil(C/A):1,breakLabel:"...",pageRangeDisplayed:2,marginPagesDisplayed:2,activeClassName:"active",pageClassName:"page-item",breakClassName:"page-item",nextLinkClassName:"page-link",pageLinkClassName:"page-link",breakLinkClassName:"page-link",previousLinkClassName:"page-link",nextClassName:"page-item next-item",previousClassName:"page-item prev-item",containerClassName:"pagination react-paginate separated-pagination pagination-sm justify-content-end pe-1 mt-1"});function X(n){let s;const i=",",p=`
`,y=Object.keys(E[0]);return s="",s+=y.join(i),s+=p,n.forEach(Y=>{let W=0;y.forEach(Z=>{W>0&&(s+=i),s+=Y[Z],W++}),s+=p}),s}async function q(){let n;c.length>0?n=c:n=(await w(1,null,u)).deals;const s=document.createElement("a");let i=X(n);if(i===null)return;const p="export.csv";i.match(/^data:text\/csv/i)||(i=`data:text/csv;charset=utf-8,${i}`),s.setAttribute("href",encodeURI(i)),s.setAttribute("download",p),s.click()}return t(o.Fragment,{children:[t(Le,{children:[t(Ae,{className:"flex-md-row flex-column align-md-items-center align-items-start border-bottom",children:[e(Ee,{tag:"h4",children:"Admins List"}),t("div",{className:"d-flex mt-md-0 mt-1",children:[t(Pe,{children:[t(B,{color:"secondary",caret:!0,outline:!0,children:[e(oe,{size:15}),e("span",{className:"align-middle ms-50",children:"Export"})]}),t(F,{children:[t(k,{className:"w-100",children:[e(de,{size:15}),e("span",{className:"align-middle ms-50",children:"Print"})]}),t(k,{className:"w-100",onClick:()=>q(),children:[e(U,{size:15}),e("span",{className:"align-middle ms-50",children:"CSV"})]})]})]}),t(L,{className:"ms-2",color:"primary",onClick:R,children:[e(me,{size:15}),e("span",{className:"align-middle ms-50",children:"Add Record"})]})]})]}),e(Te,{className:"justify-content-end mx-0",children:t(ze,{className:"d-flex align-items-center justify-content-end mt-1",md:"6",sm:"12",children:[e(N,{className:"me-1",for:"search-input",children:"Search"}),e(v,{className:"dataTable-filter mb-50",type:"text",bsSize:"sm",id:"search-input",value:u,onChange:Q})]})}),e("div",{className:"react-dataTable react-dataTable-selectable-rows",children:$?e("div",{className:"d-flex justify-content-center align-items-center py-5",children:e(Ne,{color:"primary"})}):e(pe,{noHeader:!0,pagination:!0,onPageChange:n=>z(n+1),selectableRows:!0,columns:G,paginationPerPage:10,className:"react-dataTable",sortIcon:e(ue,{size:10}),paginationComponent:K,paginationDefaultPage:l+1,selectableRowsComponent:Fe,data:u.length?h:E,onSelectedRowsChange:n=>r(n.selectedRows)})})]}),e(je,{open:a,handleModal:R})]})};export{na as default};
