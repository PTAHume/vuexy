import{r as u,I as n,k as e,P as b,M as be,j as _,B as ne,w as ve,a_ as Ne,a$ as ye,b0 as we,b1 as Se,b2 as le,b3 as Ce,U as he,b4 as ke,b5 as Me,b6 as oe,b7 as xe,b8 as ue,D as ce,b9 as Oe,ba as Le}from"./index-354b5d3b.js";import{a as H,f as A,h as $e,A as U,l as I,U as _e,D as ze,b as De,c as E,X as R,m as Ie,B as je,M as Ue,n as Pe}from"./App-3c242431.js";import{F as Ee}from"./Form-7792e388.js";import{I as F,L as Te}from"./Label-608bb7ed.js";import{I as me,a as fe}from"./InputGroupText-5c775d37.js";import{E as We,M as qe,T as Ae}from"./echo-91e3c1da.js";import{M as Re,S as ge}from"./search-b9f5c6aa.js";import{C as Fe}from"./CardText-a4ae9859.js";function Be(a,r){if(a==null)return{};var l=He(a,r),s,t;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);for(t=0;t<i.length;t++)s=i[t],!(r.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(a,s)&&(l[s]=a[s])}return l}function He(a,r){if(a==null)return{};var l={},s=Object.keys(a),t,i;for(i=0;i<s.length;i++)t=s[i],!(r.indexOf(t)>=0)&&(l[t]=a[t]);return l}var G=u.forwardRef(function(a,r){var l=a.color,s=l===void 0?"currentColor":l,t=a.size,i=t===void 0?24:t,h=Be(a,["color","size"]);return n("svg",{ref:r,xmlns:"http://www.w3.org/2000/svg",width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:s,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...h,children:[e("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]})});G.propTypes={color:b.string,size:b.oneOfType([b.string,b.number])};G.displayName="Bell";const Ge=G;function Ve(a,r){if(a==null)return{};var l=Xe(a,r),s,t;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);for(t=0;t<i.length;t++)s=i[t],!(r.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(a,s)&&(l[s]=a[s])}return l}function Xe(a,r){if(a==null)return{};var l={},s=Object.keys(a),t,i;for(i=0;i<s.length;i++)t=s[i],!(r.indexOf(t)>=0)&&(l[t]=a[t]);return l}var V=u.forwardRef(function(a,r){var l=a.color,s=l===void 0?"currentColor":l,t=a.size,i=t===void 0?24:t,h=Ve(a,["color","size"]);return n("svg",{ref:r,xmlns:"http://www.w3.org/2000/svg",width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:s,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...h,children:[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e("polyline",{points:"21 15 16 10 5 21"})]})});V.propTypes={color:b.string,size:b.oneOfType([b.string,b.number])};V.displayName="Image";const B=V;function Ye(a,r){if(a==null)return{};var l=Ke(a,r),s,t;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);for(t=0;t<i.length;t++)s=i[t],!(r.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(a,s)&&(l[s]=a[s])}return l}function Ke(a,r){if(a==null)return{};var l={},s=Object.keys(a),t,i;for(i=0;i<s.length;i++)t=s[i],!(r.indexOf(t)>=0)&&(l[t]=a[t]);return l}var X=u.forwardRef(function(a,r){var l=a.color,s=l===void 0?"currentColor":l,t=a.size,i=t===void 0?24:t,h=Ye(a,["color","size"]);return n("svg",{ref:r,xmlns:"http://www.w3.org/2000/svg",width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:s,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...h,children:[e("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),e("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]})});X.propTypes={color:b.string,size:b.oneOfType([b.string,b.number])};X.displayName="Send";const Qe=X;function Je(a,r){if(a==null)return{};var l=Ze(a,r),s,t;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);for(t=0;t<i.length;t++)s=i[t],!(r.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(a,s)&&(l[s]=a[s])}return l}function Ze(a,r){if(a==null)return{};var l={},s=Object.keys(a),t,i;for(i=0;i<s.length;i++)t=s[i],!(r.indexOf(t)>=0)&&(l[t]=a[t]);return l}var Y=u.forwardRef(function(a,r){var l=a.color,s=l===void 0?"currentColor":l,t=a.size,i=t===void 0?24:t,h=Je(a,["color","size"]);return n("svg",{ref:r,xmlns:"http://www.w3.org/2000/svg",width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:s,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...h,children:[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})]})});Y.propTypes={color:b.string,size:b.oneOfType([b.string,b.number])};Y.displayName="Slash";const ea=Y,de=new be,aa=(a,r,l)=>{u.useEffect(()=>{let s;async function t(){const i=new We({broadcaster:"pusher",key:"alikoza",cluster:"mt1",encrypted:!1,wsHost:"https://api.dealmanager.co.uk",wsPort:6001,wssPort:6001,disableStats:!0,forceTLS:!1,authEndpoint:`${de.baseurl().replace(/\s/g,"")}/api/front/subscribeToChat`,authorizer:(g,f)=>({authorize:async(N,m)=>{try{const y=await de.subscribeToChat(N,g.name);m(!1,y.data),r(y)}catch(y){m(!0,y),a(y)}}})}),h=i.private("chats");h.listen(".App\\Events\\Chat\\ChatListUpdated",g=>{l(g)}),s=()=>{h.stopListening(".App\\Events\\Chat\\ChatListUpdated"),i.disconnect()}}return t(),()=>{s&&s()}},[])},ta=a=>{var Z,ee,ae,te,se,re;const{handleUser:r,handleUserSidebarRight:l,handleSidebar:s,store:t,userSidebarLeft:i}=a,{userProfile:h,selectedUser:g,selectedChatUniqueId:f}=t,N=u.useRef(null),m=H(),[y,z]=u.useState(""),j=localStorage.getItem("skin"),L=()=>{const o=ve.findDOMNode(N.current);o.scrollTop=Number.MAX_SAFE_INTEGER},c=g.find(o=>o.id===f),T=(ee=(Z=c==null?void 0:c.data)==null?void 0:Z.chat)==null?void 0:ee.id,w=t.oldestMessageId,P=(se=(te=(ae=c==null?void 0:c.data)==null?void 0:ae.contact)==null?void 0:te.chat)==null?void 0:se.firstMessage;aa(o=>{o.response&&o.response.status},o=>{},async o=>{m(Ce(o&&o.chats));const D={id:o.chats.newMessageData.message_id,chat_id:o.chats.id,message:o.chats.newMessageData.message,time:o.chats.newMessageData.time,sender_id:o.chats.newMessageData.senderId};await m(le(g.map(p=>p.data.chat.unique_id===f?{...p,data:{...p.data,chat:{...p.data.chat,chat:[...p.data.chat.chat,D]}}}:p)))}),u.useEffect(()=>{console.log("selectedUser state in onDataReceived: ",g)},[g]);const S=async()=>{try{await m(Ne()),await m(ye({chatId:T,oldestMessageId:w||P||null}))}catch(o){console.error("Error in loadMoreMsgs:",o)}finally{m(we())}};u.useEffect(()=>{c&&Object.keys(c).length&&L()},[c]);const d=()=>{var O;let o=[];c.data.chat&&(o=(O=c.data.chat)==null?void 0:O.chat);const D=[];let p=o[0]?o[0].sender_id:void 0,x={sender_id:p,messages:[]};return o.forEach((C,q)=>{p===C.sender_id?x.messages.push({msg:C.message,time:C.time,id:C.id,status:C.status}):(p=C.sender_id,D.push(x),x={sender_id:C.sender_id,messages:[{msg:C.message,time:C.time,id:C.id,status:C.status}]}),q===o.length-1&&D.push(x)}),D},v=()=>d().map((o,D)=>n("div",{className:_("chat",{"chat-left":o.sender_id!==h.id}),children:[e("div",{className:"chat-avatar",children:e(U,{imgWidth:36,imgHeight:36,className:"box-shadow-1 cursor-pointer",img:o.sender_id!==h.id?`${I}/${c.data.contact.avatar}`:`${I}/${h.image}`})}),e("div",{className:"chat-body",children:o.messages.map(p=>{const x=new Date(p.time),O=`${x.getDate()} ${x.toLocaleString("default",{month:"long"})}, ${x.getFullYear()}`;return n("div",{className:"chat-content",children:[e("p",{children:p.msg}),e("small",{style:{fontSize:"8px",color:j==='"dark"'?"#fefe":"#000",fontStyle:"italic"},children:p.status??O})]},p.id)})})]},`${o.sender_id}-${o.messages[0].id}`)),k=o=>{l(),r(o)},M=()=>{!Object.keys(c).length&&!i&&window.innerWidth<992&&s()},W=async o=>{const x=Math.floor(Math.random()*-98)+-1;if(o.preventDefault(),y.trim().length){const O=new Date,C=`${O.getDate()} ${O.toLocaleString("default",{month:"long"})}, ${O.getFullYear()}`,q={id:x,chat_id:c.data.chat.id,message:y,time:O.toISOString(),sender_id:h.id,status:C},ie=g.find($=>$.data.chat.unique_id===f);ie&&(await m(Se({...ie,message:q})),await m(le(g.map($=>$.data.chat.unique_id===f?{...$,data:{...$.data,chat:{...$.data.chat,chat:[...$.data.chat.chat,q]}}}:$)))),z("")}},pe=c&&Object.keys(c).length&&((re=c==null?void 0:c.data)!=null&&re.chat)?A:"div";return n("div",{className:"chat-app-window",children:[n("div",{className:_("start-chat-area",{"d-none":c&&Object.keys(c).length}),children:[e("div",{className:"start-chat-icon mb-1",children:e(Re,{})}),e("h4",{className:"sidebar-toggle start-chat-text",onClick:M,children:"Start Conversation"})]}),c&&Object.keys(c).length?n("div",{className:_("active-chat",{"d-none":c===null}),children:[e("div",{className:"chat-navbar",children:n("header",{className:"chat-header",children:[n("div",{className:"d-flex align-items-center",children:[e("div",{className:"sidebar-toggle d-block d-lg-none me-1",onClick:s,children:e($e,{size:21})}),e(U,{imgHeight:"36",imgWidth:"36",img:`${I}/${c.data.contact.avatar}`,status:c.data.contact.status,className:"avatar-border user-profile-toggle m-0 me-1",onClick:()=>k(c.data.contact)}),e("h6",{className:"mb-0",children:c.data.contact.fullName})]}),n("div",{className:"d-flex align-items-center",children:[e(ge,{size:18,className:"cursor-pointer d-sm-block d-none"}),n(_e,{className:"more-options-dropdown",children:[e(ze,{className:"btn-icon",color:"transparent",size:"sm",children:e(qe,{size:"18"})}),n(De,{end:!0,children:[e(E,{href:"/",onClick:o=>o.preventDefault(),children:"View Contact"}),e(E,{href:"/",onClick:o=>o.preventDefault(),children:"Mute Notifications"}),e(E,{href:"/",onClick:o=>o.preventDefault(),children:"Block Contact"}),e(E,{href:"/",onClick:o=>o.preventDefault(),children:"Clear Chat"}),e(E,{href:"/",onClick:o=>o.preventDefault(),children:"Report"})]})]})]})]})}),n(pe,{ref:N,className:"user-chats",options:{wheelPropagation:!1},children:[e(ne,{style:{display:"block",marginLeft:"auto",marginRight:"auto"},onClick:()=>S(),disabled:w==="FINISHED",children:w==="FINISHED"?"No more messages":"Load More Messages"}),t.isLoadingMoreMsg?e("div",{id:"loading-overlay",style:{display:"flex"},children:e("div",{className:"loader"})}):c.data.chat?e("div",{className:"chats",children:v()}):null]}),n(Ee,{className:"chat-app-form",onSubmit:o=>W(o),children:[n(me,{className:"input-group-merge me-1 form-send-message",children:[e(F,{value:y,onChange:o=>z(o.target.value),placeholder:"Type your message or use speech to text"}),e(fe,{children:n(Te,{className:"attachment-icon mb-0",for:"attach-doc",children:[e(B,{className:"cursor-pointer text-secondary",size:14}),e("input",{type:"file",id:"attach-doc",hidden:!0})]})})]}),n(ne,{className:"send",color:"primary",children:[e(Qe,{size:14,className:"d-lg-none"}),e("span",{className:"d-none d-lg-block",children:"Send"})]})]})]}):null]})},sa=a=>{const{store:r,sidebar:l,handleSidebar:s,userSidebarLeft:t,handleUserSidebarLeft:i}=a,{chats:h,contacts:g,userProfile:f}=r,N=H(),[m,y]=u.useState("");u.useState("");const[z,j]=u.useState({chatId:null,userId:null,uniqueId:null}),[L,c]=u.useState([]),[T,w]=u.useState([]),P=S=>Object.keys(S).length===0&&S.constructor===Object,K=async S=>{var k;const d=h.find(M=>M.unique_id===S),v=r.selectedUser.find(M=>{var W;return M.data.chat.id===((W=d.chat)==null?void 0:W.id)});if(!v||v.data.chat.id!==((k=d.chat)==null?void 0:k.id))try{await N(ke()),await N(Me(d==null?void 0:d.unique_id)),await N(oe(d==null?void 0:d.unique_id)),await N(xe(null))}catch(M){console.error("Error in handleUserClick:",M)}finally{N(ue())}else j({chatId:v.data.chat.id,userId:v.data.contact.id,uniqueId:v.id}),await N(oe(d==null?void 0:d.unique_id));l===!0&&s()};u.useEffect(()=>{var S,d,v;if(!P(r.selectedUser)){const k=r.selectedUser.find(M=>M.data.chat.unique_id===r.selectedChatUniqueId);k&&j({chatId:(S=k.data.chat)==null?void 0:S.id,userId:(d=k.data.contact)==null?void 0:d.id,uniqueId:(v=k.data.chat)==null?void 0:v.unique_id})}},[r.selectedUser,r.selectedChatUniqueId]);const Q=()=>h&&h.length?m.length&&!L.length?e("li",{className:"no-results show",children:e("h6",{className:"mb-0",children:"No Chats Found"})}):(m.length&&L.length?L:h).map(d=>{const v=Ie(d.chat.lastMessage?d.chat.lastMessage.time:new Date);return n("li",{onClick:()=>K(d.unique_id),className:_({active:z.uniqueId===d.unique_id}),children:[e(U,{img:`${I}/${d.avatar}`,imgHeight:"42",imgWidth:"42",status:d.status}),n("div",{className:"chat-info flex-grow-1",children:[e("h5",{className:"mb-0",children:d.about}),e(Fe,{className:"text-truncate",children:d.chat.lastMessage?d.chat.lastMessage.message:h[h.length-1].message})]}),n("div",{className:"chat-meta text-nowrap",children:[e("small",{className:"float-end mb-25 chat-time ms-25",children:v}),d.chat.unseenMsgsForUser>=1&&f.id!==d.chat.lastMessage.senderId?e(je,{className:"float-end",color:"danger",pill:!0,children:d.chat.unseenMsgsForUser}):null]})]},`${d.chat.id}_${d.id}`)}):null,J=S=>{y(S.target.value);const d=M=>M.fullName.toLowerCase().includes(S.target.value.toLowerCase()),v=h==null?void 0:h.filter(d),k=g==null?void 0:g.filter(d);Array.isArray(v)?c([...v]):c([]),Array.isArray(k)?w([...k]):w([])};return r?e("div",{className:"sidebar-left",children:r.isLoading?e("div",{id:"loading-overlay",style:{display:"flex"},children:e("div",{className:"loader"})}):e(he,{children:n("div",{className:"sidebar",children:[n("div",{className:_("chat-profile-sidebar",{show:t}),children:[n("header",{className:"chat-profile-header",children:[e("div",{className:"close-icon",onClick:i,children:e(R,{size:14})}),n("div",{className:"header-profile-sidebar",children:[e(U,{className:"box-shadow-1 avatar-border",img:`${I}/${f.image}`,status:f.online_status,size:"xl"}),e("h4",{className:"chat-user-name",children:f.fullName}),e("span",{className:"user-post",children:f.role})]})]}),n(A,{className:"profile-sidebar-area",options:{wheelPropagation:!1},children:[e("h6",{className:"section-label mb-1 mt-2",children:"Settings"}),n("ul",{className:"list-unstyled",children:[n("li",{className:"d-flex justify-content-between align-items-center mb-1",children:[n("div",{className:"d-flex align-items-center",children:[e(Ge,{className:"me-75",size:"18"}),e("span",{className:"align-middle",children:"Notification"})]}),e("div",{className:"form-switch",children:e(F,{type:"switch",id:"notifications",name:"notifications"})})]}),n("li",{className:"d-flex align-items-center cursor-pointer",children:[e(Ae,{className:"me-75",size:"18"}),e("span",{className:"align-middle",children:"Delete Chat"})]})]})]})]}),n("div",{className:_("sidebar-content",{show:l===!0}),children:[e("div",{className:"sidebar-close-icon",onClick:s,children:e(R,{size:14})}),e("div",{className:"chat-fixed-search",children:n("div",{className:"d-flex align-items-center w-100",children:[e("div",{className:"sidebar-profile-toggle",onClick:i,children:Object.keys(f).length?e(U,{className:"avatar-border",img:`${I}/${f.image}`,status:f.online_status,imgHeight:"42",imgWidth:"42"}):null}),n(me,{className:"input-group-merge ms-1 w-100",children:[e(fe,{className:"round",children:e(ge,{className:"text-muted",size:14})}),e(F,{value:m,className:"round",placeholder:"Search or start a new chat",onChange:J})]})]})}),n(A,{className:"chat-user-list-wrapper list-group",options:{wheelPropagation:!1},children:[e("h4",{className:"chat-list-title",children:"Airline Baggages"}),e("ul",{className:"chat-users-list chat-list media-list",children:Q()}),e("h4",{className:"chat-list-title",children:"Hotels"}),e("ul",{className:"chat-users-list contact-list media-list"}),e("h4",{className:"chat-list-title",children:"Coupons"}),e("ul",{className:"chat-users-list contact-list media-list"})]})]})]})})}):null},ra=a=>{const{user:r,handleUserSidebarRight:l,userSidebarRight:s}=a;return n("div",{className:_("user-profile-sidebar",{show:s===!0}),children:[n("header",{className:"user-profile-header",children:[e("span",{className:"close-icon",onClick:l,children:e(R,{size:14})}),n("div",{className:"header-profile-sidebar",children:[e(U,{className:"box-shadow-1 avatar-border",size:"xl",status:r.status,img:r.avatar?`${I}/${r.avatar}`:"",imgHeight:"70",imgWidth:"70"}),e("h4",{className:"chat-user-name",children:r.fullName}),e("span",{className:"user-post",children:r.role})]})]}),n(A,{className:"user-profile-sidebar-area",options:{wheelPropagation:!1},children:[e("h6",{className:"section-label mb-1",children:"Delivery Details"}),e("p",{children:r.about}),e("p",{children:r.departure_date}),e("p",{children:r.arrival_date}),e("p",{children:r.flight_number??"Not mentioned"}),n("p",{children:[r.weight," Kg"]}),n("p",{children:[r.price,"$"]}),n("div",{className:"personal-info",children:[e("h6",{className:"section-label mb-1 mt-3",children:"Personal Information"}),e("ul",{className:"list-unstyled",children:n("li",{className:"mb-1",children:[e(Ue,{className:"me-75",size:17}),e("span",{className:"align-middle",children:r.user_authenticated===1?"Authenticated":"Unatuhenticated"})]})})]}),n("div",{className:"more-options",children:[e("h6",{className:"section-label mb-1 mt-3",children:"Options"}),n("ul",{className:"list-unstyled",children:[n("li",{className:"cursor-pointer mb-1",children:[e(B,{className:"me-50",size:17}),e("span",{className:"align-middle",children:" Go to Seller Profile"})]}),n("li",{className:"cursor-pointer mb-1",children:[e(B,{className:"me-50",size:17}),e("span",{className:"align-middle",children:" Go to Offer"})]}),n("li",{className:"cursor-pointer",children:[e(ea,{className:"me-75",size:17}),e("span",{className:"align-middle",children:"Block Contact"})]})]})]})]})]})};const ma=()=>{const a=ce(w=>w),r=Pe(a),l=ce(w=>w.chatData),s=H(),[t,i]=u.useState({}),[h,g]=u.useState(!1),[f,N]=u.useState(!1),[m,y]=u.useState(!1),z=()=>g(!h),j=()=>y(!m),L=()=>N(!f),c=()=>{g(!1),N(!1),y(!1)},T=w=>i(w);return u.useEffect(()=>{(async()=>{try{await Promise.all([s(Oe()).unwrap(),s(Le(r.id)).unwrap()])}catch(P){console.error("Error fetching data:",P)}finally{s(ue())}})()},[s,r.id]),e(u.Fragment,{children:l.isLoading?e("div",{id:"loading-overlay",style:{display:"flex"},children:e("div",{className:"loader"})}):n(he,{children:[e(sa,{store:l,sidebar:h,handleSidebar:z,userSidebarLeft:m,handleUserSidebarLeft:j}),e("div",{className:"content-right",children:e("div",{className:"content-wrapper",children:n("div",{className:"content-body",children:[e("div",{className:_("body-content-overlay",{show:f===!0||h===!0||m===!0}),onClick:c}),e(ta,{store:l,handleUser:T,handleSidebar:z,userSidebarLeft:m,handleUserSidebarRight:L}),e(ra,{user:t,userSidebarRight:f,handleUserSidebarRight:L})]})})})]})})};export{ma as default};
